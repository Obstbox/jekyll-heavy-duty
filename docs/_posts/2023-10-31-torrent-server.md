---
layout: post
title: сказ о том, как из нетбука сервачок делал
---

# Постановка задачи
Имеется старый нетбук _Lenovo Ideapad_ c 32-х битным __Intel Atom N2600__ и __2__GB ОЗУ на борту. Системой выбрал
стабильный на текущий момент _debian bookworm_, потому что от `x86` большинство дистров давно отказались, а у меня
планируется хоть и не настоящий, но всё-таки сервер и нужна стабильность системы.  

Задачи: для начала _торренты_ и _DLNA_. Если мощи будет хватать, возможны локальный веб-сервер, или хост для принтера со
сканнером.  
__TL;DR__ С 4 ядрами и 2 гигами на нём вполне мог бы жить какой-нибудь _linux mint_, даже ютуб в 720р смотреть
можно было бы. Но процессор постоянно уходит в энергосбережние, частота колеблется в районе 600 - 800 МГц. Я много чего 
пробовал делать, но рабочего решения не нашёл. 

## выбор torrent клиента
Недавно на другой машине ставил _rtorrent_. Он отлично работает, но есть пара нюансов:
- крайне неудобно назначать файлы для частичной закачки  
- при аварийном выключении (свет пропал), сессия зависает, и перезапустить её можно только удалив файл сессии. что
приводит к тому, что частичные закачки становятся полными, ~~а я не ради этого полчаса доблил по пробелу~~ и тут же
стартует закачка _всех_ игнорировавшихся ранее файлов  

Нужно что-то имеющее демона и веб-морду. Просмотрев вывод `apt search`, остановился на _transmission_ и _deluge_.  

### transmission
По итогу от него пришлось отказаться. Хотя дело, по всей видимости, было не в самой программе.  
__TL;DR__ можно сразу перейти к __deluge__  
Установка тривиальная: `apt install transmission-daemon, transmission-remote`  
Сложности начались сразу:
- Долго не получалось настроить доступ с другого локального IP. всё свелось к устаровке в `false` одного из 
`rpc_`-параметров.  
- Чтобы менять системные настройки, нужно было останавливать демона, править конфиг, и запускать обратно. В принципе
логично, но все равно не клёво.  
- Веб-страница постоянно теряла связь с сервером, но с этим я даже не стал разбираться из-за самого главного:  
- Попав наконец в веб-интерфейс я очень порадовался тому, как с ним удобно работать. Но закачки почему-то не шли.
Проблема была в правах доступа, но никакие махинации с ними не давали результата, закачка просто не шла.  
Возможно, покапавшись еще немного, я решил бы эту проблему, но постоянно падающая связь с вебом отбила такое желание.

### deluge
Тут веселья было еще больше.

Как умный, сразу пошёл на офф сайт и начал следовать инструкциям оттуда. Сводились они к
тому, что нужно создать пользователя `deluge` а потом ручками написать _sysmted сервисы_ для запуска демона и веб-морды.
**Нет, не нужно**, потому что после установки автоматом уже были созданы пользователь `debian-deluge` и сервисы
`deluged.sevice`, `deluge-web.service`, но я этого не знал и сразу не проверил и пришлось вычищать свои наработки.
__TL;DR__ Однако с дефолтными юнитами, команда `#systemctl status deluge-web` выдавала предупреждения, что-то про питоновскую 
библиотеку `twisted` (в логах тоже), `gettext` и несогласованное кол-во параметов, передаваемых в одну из функций. Гугл 
наводил меня на посты двух-летней давности, о том, что проблема решена и что в любом случае это не критичные ошибки, и
вообще, ставьте _deluge_ и зависимости к нему через _pip3_. Я забил и пошёл дальше.

Веб-морда заработала сразу, что очень порадовало. И как в случае с _transmission_, в конфигах у меня были прописаны одни
пути, веб-интерфейс указывал совсем другие. Я прописал их и здесь тоже. И... закачки опять не идут.  

Помучившись снова с правами, удалил _deluge_ со всеми файлами, переустановил и запустил как есть. Автоматически 
создалась директория `/var/lib/deluged/Downloads/` и закачка пошла. Только вот мне нужен другой путь, в домашнюю 
директорию (а позже - на внешний диск). Изменение пути через конфиг-файл и через веб-морду приводили к ошибке прав
доступа. Что я пробовал делать в этот раз?  
- отредактировал `deluged.sevice`, `deluge-web.service`, выставив `UMask=000` (полный доступ всем)  
- `systemctl daemon-reload` (обязательно после редактирования файлов)
- запустил оба сервиса  
- создал `/home/ivan/Torrents`. Выставил на неё права и владельца точно такими же, как у `/var/lib/deluged/Downloads/`
И опять не сработало.  
На форуме deluge есть посты с такой же проблемой. Оказалось, причина её в том, что у _родительской директории_ **тоже**
должны быть правильные права! Поэтому я разместил всё нужное в `/home/torrents/`, назначил права, прописал пути через
веб-морду и вот теперь наконец-то ___заработало!___  

Осталось две проблемы.  
Хотя пользователь `ivan` добавлен в группу `debian-deluge`, доступа в `/home/torrents/` у него
нет, несмотря даже на `MODE=777`.
При подключении к вебу, нужно каждый раз подтверждать согласие на коннект, что раздражает и вообще мне не нужно.  
Но я и так потерял кучу времени на такую простую задачу, может быть разберусь когда-нибудь потом.  

## deban сервер
ssh доступ  
кодировки?  
`su -`  
`vbtool, setterm`  
`grub чотатам = 60`  
